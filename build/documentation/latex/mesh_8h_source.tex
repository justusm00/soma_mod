\hypertarget{mesh_8h_source}{}\doxysection{mesh.\+h}
\label{mesh_8h_source}\index{mesh.h@{mesh.h}}
\mbox{\hyperlink{mesh_8h}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{1 \textcolor{comment}{/* Copyright (C) 2016-\/2021 Ludwig Schneider}}
\DoxyCodeLine{2 \textcolor{comment}{   Copyright (C) 2016 Ulrich Welling}}
\DoxyCodeLine{3 \textcolor{comment}{   Copyright (C) 2016 Marcel Langenberg}}
\DoxyCodeLine{4 \textcolor{comment}{   Copyright (C) 2016 Fabien Leonforte}}
\DoxyCodeLine{5 \textcolor{comment}{   Copyright (C) 2016 Juan Orozco}}
\DoxyCodeLine{6 \textcolor{comment}{   Copyright (C) 2016 Yongzhi Ren}}
\DoxyCodeLine{7 \textcolor{comment}{}}
\DoxyCodeLine{8 \textcolor{comment}{ This file is part of SOMA.}}
\DoxyCodeLine{9 \textcolor{comment}{}}
\DoxyCodeLine{10 \textcolor{comment}{ SOMA is free software: you can redistribute it and/or modify}}
\DoxyCodeLine{11 \textcolor{comment}{ it under the terms of the GNU Lesser General Public License as published by}}
\DoxyCodeLine{12 \textcolor{comment}{ the Free Software Foundation, either version 3 of the License, or}}
\DoxyCodeLine{13 \textcolor{comment}{ (at your option) any later version.}}
\DoxyCodeLine{14 \textcolor{comment}{}}
\DoxyCodeLine{15 \textcolor{comment}{ SOMA is distributed in the hope that it will be useful,}}
\DoxyCodeLine{16 \textcolor{comment}{ but WITHOUT ANY WARRANTY; without even the implied warranty of}}
\DoxyCodeLine{17 \textcolor{comment}{ MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the}}
\DoxyCodeLine{18 \textcolor{comment}{ GNU Lesser General Public License for more details.}}
\DoxyCodeLine{19 \textcolor{comment}{}}
\DoxyCodeLine{20 \textcolor{comment}{ You should have received a copy of the GNU Lesser General Public License}}
\DoxyCodeLine{21 \textcolor{comment}{ along with SOMA.  If not, see <http://www.gnu.org/licenses/>.}}
\DoxyCodeLine{22 \textcolor{comment}{*/}}
\DoxyCodeLine{23 \textcolor{preprocessor}{\#ifndef SOMA\_MESH\_H}}
\DoxyCodeLine{24 \textcolor{preprocessor}{\#define SOMA\_MESH\_H}}
\DoxyCodeLine{39 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{soma__config_8h}{soma\_config.h}}"{}}}
\DoxyCodeLine{40 \textcolor{preprocessor}{\#include "{}\mbox{\hyperlink{phase_8h}{phase.h}}"{}}}
\DoxyCodeLine{41 }
\DoxyCodeLine{42 \textcolor{preprocessor}{\#pragma acc routine(coord\_to\_cell\_coordinate) seq}}
\DoxyCodeLine{43 \textcolor{keyword}{static} \textcolor{keyword}{inline} \textcolor{keywordtype}{void} coord\_to\_cell\_coordinate(\textcolor{keyword}{const} \textcolor{keyword}{struct} \mbox{\hyperlink{structPhase}{Phase}} *p, \textcolor{keyword}{const} \mbox{\hyperlink{soma__config_8h_a59e3fe53d267a97ff32b8a16fea1f683}{soma\_scalar\_t}} rx, \textcolor{keyword}{const} \mbox{\hyperlink{soma__config_8h_a59e3fe53d267a97ff32b8a16fea1f683}{soma\_scalar\_t}} ry,}
\DoxyCodeLine{44                                             \textcolor{keyword}{const} \mbox{\hyperlink{soma__config_8h_a59e3fe53d267a97ff32b8a16fea1f683}{soma\_scalar\_t}} rz, \textcolor{keywordtype}{int} *x, \textcolor{keywordtype}{int} *y, \textcolor{keywordtype}{int} *z);}
\DoxyCodeLine{45 \textcolor{keyword}{inline} \textcolor{keywordtype}{void} coord\_to\_cell\_coordinate(\textcolor{keyword}{const} \textcolor{keyword}{struct} \mbox{\hyperlink{structPhase}{Phase}} *p, \textcolor{keyword}{const} \mbox{\hyperlink{soma__config_8h_a59e3fe53d267a97ff32b8a16fea1f683}{soma\_scalar\_t}} rx, \textcolor{keyword}{const} \mbox{\hyperlink{soma__config_8h_a59e3fe53d267a97ff32b8a16fea1f683}{soma\_scalar\_t}} ry,}
\DoxyCodeLine{46                                      \textcolor{keyword}{const} \mbox{\hyperlink{soma__config_8h_a59e3fe53d267a97ff32b8a16fea1f683}{soma\_scalar\_t}} rz, \textcolor{keywordtype}{int} *x, \textcolor{keywordtype}{int} *y, \textcolor{keywordtype}{int} *z)}
\DoxyCodeLine{47 \{}
\DoxyCodeLine{48 }
\DoxyCodeLine{49     \mbox{\hyperlink{soma__config_8h_a59e3fe53d267a97ff32b8a16fea1f683}{soma\_scalar\_t}} px, py, pz;}
\DoxyCodeLine{50 }
\DoxyCodeLine{51     \textcolor{comment}{// Fold coordinate back into the box}}
\DoxyCodeLine{52     px = rx -\/ p-\/>\mbox{\hyperlink{structPhase_af37cab52be36b6c180cb481105d2a670}{Lx}} * (int)(rx * p-\/>\mbox{\hyperlink{structPhase_a125e51c2d5f0cd14ba2a1939075c72d5}{iLx}});}
\DoxyCodeLine{53     py = ry -\/ p-\/>\mbox{\hyperlink{structPhase_a43f5b1d85c34c859052bd6177fcca271}{Ly}} * (int)(ry * p-\/>\mbox{\hyperlink{structPhase_acd19c1ef72c6a2534a99da6dbe0e45e4}{iLy}});}
\DoxyCodeLine{54     pz = rz -\/ p-\/>\mbox{\hyperlink{structPhase_a4a4685eb844566059d9a1f5674403078}{Lz}} * (int)(rz * p-\/>\mbox{\hyperlink{structPhase_ade123101d46902023cb1f53af6244d79}{iLz}});}
\DoxyCodeLine{55 }
\DoxyCodeLine{56     \textcolor{comment}{// Assure correct symmetry at coordinate = 0}}
\DoxyCodeLine{57     \textcolor{keywordflow}{if} (px < 0)}
\DoxyCodeLine{58         px = p-\/>\mbox{\hyperlink{structPhase_af37cab52be36b6c180cb481105d2a670}{Lx}} + px;}
\DoxyCodeLine{59     \textcolor{keywordflow}{if} (py < 0)}
\DoxyCodeLine{60         py = p-\/>\mbox{\hyperlink{structPhase_a43f5b1d85c34c859052bd6177fcca271}{Ly}} + py;}
\DoxyCodeLine{61     \textcolor{keywordflow}{if} (pz < 0)}
\DoxyCodeLine{62         pz = p-\/>\mbox{\hyperlink{structPhase_a4a4685eb844566059d9a1f5674403078}{Lz}} + pz;}
\DoxyCodeLine{63 }
\DoxyCodeLine{64     \textcolor{comment}{// Calculate index}}
\DoxyCodeLine{65     *x = (int)(px * p-\/>\mbox{\hyperlink{structPhase_a125e51c2d5f0cd14ba2a1939075c72d5}{iLx}} * p-\/>\mbox{\hyperlink{structPhase_a2329909fa78c33912eaf8a29ce0ab063}{nx}});}
\DoxyCodeLine{66     *y = (int)(py * p-\/>\mbox{\hyperlink{structPhase_acd19c1ef72c6a2534a99da6dbe0e45e4}{iLy}} * p-\/>\mbox{\hyperlink{structPhase_a15694b05ef83dc4969168d747c6f6075}{ny}});}
\DoxyCodeLine{67     *z = (int)(pz * p-\/>\mbox{\hyperlink{structPhase_ade123101d46902023cb1f53af6244d79}{iLz}} * p-\/>\mbox{\hyperlink{structPhase_a74a2c423b591fc35b13fc6b363600490}{nz}});}
\DoxyCodeLine{68 \}}
\DoxyCodeLine{69 }
\DoxyCodeLine{79 \textcolor{keyword}{static} \textcolor{keyword}{inline} uint64\_t cell\_coordinate\_to\_index(\textcolor{keyword}{const} \textcolor{keyword}{struct} \mbox{\hyperlink{structPhase}{Phase}} *p, \textcolor{keyword}{const} \textcolor{keywordtype}{int} x, \textcolor{keyword}{const} \textcolor{keywordtype}{int} y, \textcolor{keyword}{const} \textcolor{keywordtype}{int} z);}
\DoxyCodeLine{80 \textcolor{preprocessor}{\#pragma acc routine(cell\_coordinate\_to\_index) seq}}
\DoxyCodeLine{81 \textcolor{keyword}{inline} uint64\_t cell\_coordinate\_to\_index(\textcolor{keyword}{const} \textcolor{keyword}{struct} \mbox{\hyperlink{structPhase}{Phase}} *p, \textcolor{keyword}{const} \textcolor{keywordtype}{int} x, \textcolor{keyword}{const} \textcolor{keywordtype}{int} y, \textcolor{keyword}{const} \textcolor{keywordtype}{int} z)}
\DoxyCodeLine{82 \{}
\DoxyCodeLine{83     \textcolor{keywordtype}{int} xt = x;}
\DoxyCodeLine{84 \textcolor{preprocessor}{\#if ( ENABLE\_DOMAIN\_DECOMPOSITION == 1 )}}
\DoxyCodeLine{85     \textcolor{comment}{//For performance reasons compile the domain decomposition only if necessary}}
\DoxyCodeLine{86     \textcolor{keywordflow}{if} (p-\/>\mbox{\hyperlink{structPhase_af8a0cdf69874e252855d8d3c6c2189ce}{args}}.\mbox{\hyperlink{structsom__args_a765cf3b7df1d84c1e6adad6d26e3b7fa}{N\_domains\_arg}} > 1)}
\DoxyCodeLine{87         \{}
\DoxyCodeLine{88             \textcolor{keywordflow}{if} (xt >= p-\/>\mbox{\hyperlink{structPhase_ad3b5852e00ad8767519325975d86491f}{local\_nx\_high}}) \textcolor{comment}{//Wrap back if necessary}}
\DoxyCodeLine{89                 xt -\/= p-\/>\mbox{\hyperlink{structPhase_a2329909fa78c33912eaf8a29ce0ab063}{nx}};}
\DoxyCodeLine{90             \textcolor{keywordflow}{if} (xt < p-\/>local\_nx\_low)}
\DoxyCodeLine{91                 xt += p-\/>\mbox{\hyperlink{structPhase_a2329909fa78c33912eaf8a29ce0ab063}{nx}};}
\DoxyCodeLine{92             \textcolor{keywordflow}{if} (xt < p-\/>local\_nx\_low || xt >= p-\/>\mbox{\hyperlink{structPhase_ad3b5852e00ad8767519325975d86491f}{local\_nx\_high}})}
\DoxyCodeLine{93                 \{}
\DoxyCodeLine{94                     \textcolor{keywordflow}{return} UINT64\_MAX;  \textcolor{comment}{//Error, requested index out of local bounds}}
\DoxyCodeLine{95                 \}}
\DoxyCodeLine{96             xt -\/= p-\/>\mbox{\hyperlink{structPhase_a7a0cba7aa179de61aeffc9a0440c4e12}{local\_nx\_low}};}
\DoxyCodeLine{97         \}}
\DoxyCodeLine{98 \textcolor{preprocessor}{\#endif                          }\textcolor{comment}{//ENABLE\_MIC}}
\DoxyCodeLine{99     \textcolor{comment}{//Unified data layout [type][x][y][z]}}
\DoxyCodeLine{100     \textcolor{keywordflow}{return} xt * p-\/>\mbox{\hyperlink{structPhase_a15694b05ef83dc4969168d747c6f6075}{ny}} * p-\/>\mbox{\hyperlink{structPhase_a74a2c423b591fc35b13fc6b363600490}{nz}} + y * p-\/>\mbox{\hyperlink{structPhase_a74a2c423b591fc35b13fc6b363600490}{nz}} + z;}
\DoxyCodeLine{101 \}}
\DoxyCodeLine{102 }
\DoxyCodeLine{117 \textcolor{preprocessor}{\#pragma acc routine(coord\_to\_index) seq}}
\DoxyCodeLine{118 \textcolor{keyword}{static} \textcolor{keyword}{inline} uint64\_t coord\_to\_index(\textcolor{keyword}{const} \textcolor{keyword}{struct} \mbox{\hyperlink{structPhase}{Phase}} *\textcolor{keyword}{const} p, \textcolor{keyword}{const} \mbox{\hyperlink{soma__config_8h_a59e3fe53d267a97ff32b8a16fea1f683}{soma\_scalar\_t}} rx, \textcolor{keyword}{const} \mbox{\hyperlink{soma__config_8h_a59e3fe53d267a97ff32b8a16fea1f683}{soma\_scalar\_t}} ry,}
\DoxyCodeLine{119                                       \textcolor{keyword}{const} \mbox{\hyperlink{soma__config_8h_a59e3fe53d267a97ff32b8a16fea1f683}{soma\_scalar\_t}} rz);}
\DoxyCodeLine{120 \textcolor{keyword}{inline} uint64\_t coord\_to\_index(\textcolor{keyword}{const} \textcolor{keyword}{struct} \mbox{\hyperlink{structPhase}{Phase}} *p, \textcolor{keyword}{const} \mbox{\hyperlink{soma__config_8h_a59e3fe53d267a97ff32b8a16fea1f683}{soma\_scalar\_t}} rx, \textcolor{keyword}{const} \mbox{\hyperlink{soma__config_8h_a59e3fe53d267a97ff32b8a16fea1f683}{soma\_scalar\_t}} ry,}
\DoxyCodeLine{121                                \textcolor{keyword}{const} \mbox{\hyperlink{soma__config_8h_a59e3fe53d267a97ff32b8a16fea1f683}{soma\_scalar\_t}} rz)}
\DoxyCodeLine{122 \{}
\DoxyCodeLine{123     \textcolor{keywordtype}{int} x, y, z;}
\DoxyCodeLine{124     coord\_to\_cell\_coordinate(p, rx, ry, rz, \&x, \&y, \&z);}
\DoxyCodeLine{125     \textcolor{keywordflow}{return} cell\_coordinate\_to\_index(p, x, y, z);}
\DoxyCodeLine{126 \}}
\DoxyCodeLine{127 }
\DoxyCodeLine{135 \textcolor{preprocessor}{\#pragma acc routine(cell\_to\_index\_unified) seq}}
\DoxyCodeLine{136 \textcolor{keyword}{static} \textcolor{keyword}{inline} uint64\_t cell\_to\_index\_unified(\textcolor{keyword}{const} \textcolor{keyword}{struct} \mbox{\hyperlink{structPhase}{Phase}} *\textcolor{keyword}{const} p, \textcolor{keyword}{const} uint64\_t cell,}
\DoxyCodeLine{137                                              \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} rtype);}
\DoxyCodeLine{138 \textcolor{keyword}{inline} uint64\_t cell\_to\_index\_unified(\textcolor{keyword}{const} \textcolor{keyword}{struct} \mbox{\hyperlink{structPhase}{Phase}} *\textcolor{keyword}{const} p, \textcolor{keyword}{const} uint64\_t cell, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} rtype)}
\DoxyCodeLine{139 \{}
\DoxyCodeLine{140     \textcolor{keywordflow}{if} (cell == UINT64\_MAX)     \textcolor{comment}{//Error cell out of bounds}}
\DoxyCodeLine{141         \textcolor{keywordflow}{return} UINT64\_MAX;}
\DoxyCodeLine{142     \textcolor{comment}{//Unified data layout [type][x][y][z]}}
\DoxyCodeLine{143     \textcolor{keywordflow}{return} cell + rtype * p-\/>\mbox{\hyperlink{structPhase_af97653c4b2db4593eadc65d9aa9ffb4e}{n\_cells\_local}};}
\DoxyCodeLine{144 \}}
\DoxyCodeLine{145 }
\DoxyCodeLine{161 \textcolor{preprocessor}{\#pragma acc routine(coord\_to\_index\_unified) seq}}
\DoxyCodeLine{162 \textcolor{keyword}{static} \textcolor{keyword}{inline} uint64\_t coord\_to\_index\_unified(\textcolor{keyword}{const} \textcolor{keyword}{struct} \mbox{\hyperlink{structPhase}{Phase}} *\textcolor{keyword}{const} p, \textcolor{keyword}{const} \mbox{\hyperlink{soma__config_8h_a59e3fe53d267a97ff32b8a16fea1f683}{soma\_scalar\_t}} rx,}
\DoxyCodeLine{163                                               \textcolor{keyword}{const} \mbox{\hyperlink{soma__config_8h_a59e3fe53d267a97ff32b8a16fea1f683}{soma\_scalar\_t}} ry, \textcolor{keyword}{const} \mbox{\hyperlink{soma__config_8h_a59e3fe53d267a97ff32b8a16fea1f683}{soma\_scalar\_t}} rz, \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} rtype);}
\DoxyCodeLine{164 \textcolor{keyword}{inline} uint64\_t coord\_to\_index\_unified(\textcolor{keyword}{const} \textcolor{keyword}{struct} \mbox{\hyperlink{structPhase}{Phase}} *p, \textcolor{keyword}{const} \mbox{\hyperlink{soma__config_8h_a59e3fe53d267a97ff32b8a16fea1f683}{soma\_scalar\_t}} rx, \textcolor{keyword}{const} \mbox{\hyperlink{soma__config_8h_a59e3fe53d267a97ff32b8a16fea1f683}{soma\_scalar\_t}} ry,}
\DoxyCodeLine{165                                        \textcolor{keyword}{const} \mbox{\hyperlink{soma__config_8h_a59e3fe53d267a97ff32b8a16fea1f683}{soma\_scalar\_t}} rz, \textcolor{keyword}{const} \textcolor{keywordtype}{unsigned} \textcolor{keywordtype}{int} rtype)}
\DoxyCodeLine{166 \{}
\DoxyCodeLine{167     \textcolor{keywordtype}{int} x, y, z;}
\DoxyCodeLine{168 }
\DoxyCodeLine{169     coord\_to\_cell\_coordinate(p, rx, ry, rz, \&x, \&y, \&z);}
\DoxyCodeLine{170     \textcolor{keyword}{const} uint64\_t cell = cell\_coordinate\_to\_index(p, x, y, z);}
\DoxyCodeLine{171     \textcolor{keywordflow}{return} cell\_to\_index\_unified(p, cell, rtype);}
\DoxyCodeLine{172 \}}
\DoxyCodeLine{173 }
\DoxyCodeLine{182 \textcolor{keywordtype}{int} \mbox{\hyperlink{mesh_8h_a91f5d4bd90198f2aeb63f55c52964f49}{update\_density\_fields}}(\textcolor{keyword}{const} \textcolor{keyword}{struct} \mbox{\hyperlink{structPhase}{Phase}} *\textcolor{keyword}{const} p);}
\DoxyCodeLine{183 }
\DoxyCodeLine{195 \textcolor{keywordtype}{void} \mbox{\hyperlink{mesh_8h_aea6bc87873210c49b7321a9daccd879c}{update\_omega\_fields}}(\textcolor{keyword}{const} \textcolor{keyword}{struct} \mbox{\hyperlink{structPhase}{Phase}} *\textcolor{keyword}{const} p);}
\DoxyCodeLine{196 }
\DoxyCodeLine{203 \textcolor{keywordtype}{void} \mbox{\hyperlink{mesh_8h_a618d71a3f05754263864a225388aa1cb}{update\_omega\_fields\_scmf0}}(\textcolor{keyword}{const} \textcolor{keyword}{struct} \mbox{\hyperlink{structPhase}{Phase}} *\textcolor{keyword}{const} p);}
\DoxyCodeLine{204 }
\DoxyCodeLine{211 \textcolor{keywordtype}{void} \mbox{\hyperlink{mesh_8h_ac653af526188b98300934b90ea760073}{update\_omega\_fields\_scmf1}}(\textcolor{keyword}{const} \textcolor{keyword}{struct} \mbox{\hyperlink{structPhase}{Phase}} *\textcolor{keyword}{const} p);}
\DoxyCodeLine{212 }
\DoxyCodeLine{213 \textcolor{preprocessor}{\#endif                          }\textcolor{comment}{//SOMA\_MESH\_H}}

\end{DoxyCode}
