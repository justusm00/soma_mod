\hypertarget{design_Reviewing}{}\doxysection{a Branch}\label{design_Reviewing}
This section helps to check certain points before a reviewer accepts a branch for SOMA.
\begin{DoxyItemize}
\item license acceptance from the authors of the branch
\item license header and output
\item \char`\"{}git diff\char`\"{} with master
\begin{DoxyItemize}
\item coding style\+: \mbox{\hyperlink{design_accept_code}{Guidelines for Coding}}
\item flexibility
\item performance
\item never repeat yourself
\item part of the SOMA core or plugin
\end{DoxyItemize}
\item compilation without warnings and errors for CPU and GPU builds. (gcc and pgcc)
\item all \char`\"{}old\char`\"{} tests pass without incident
\item ensure physically correct (integrated unit test)
\item coding correctness (integrated unit test + your own test)
\item ensure no performance degradation
\item optimized for GPUs and CPUs
\item profiling if necessary
\end{DoxyItemize}\hypertarget{design_general}{}\doxysection{General Remarks}\label{design_general}
We the development team of SOMA put in a lot of effort to get SOMA fast and flexible at the same time. This required a decent design. This sections compiles a few general remarks about this design. As well as a list of quality requirements for further extensions of SOMA. Please respect these guidelines, to keep SOMA flexible, fast and up-\/to-\/date. So before you start the development of anything, start by reading this page.

One important aspect for coordinated programming with more than one person is version control. For SOMA we agreed to use \char`\"{}git\char`\"{} for this purpose. The location of SOMA git server might change from time to time. Right now the location is the fusionforge sever of the TU-\/\+Dresden. You can find it \href{https://fusionforge.zih.tu-dresden.de/scm/?group_id=1593}{\texttt{ here }}. For access it might be required to get an account on fusionforge and talk to Ludwig (ludwig.\+schneider (at) theorie.\+physik.\+uni-\/goettingen.\+de), he can grand access for you. To keep SOMA one consistent program please do all your development in the frame work of this git repository. But do your development {\itshape not} on the master branch. This branch is reserved for tested and accepted features of SOMA. Instead create your own branch and develop there. 
\begin{DoxyCode}{0}
\DoxyCodeLine{git branch your-\/branch-\/name}
\DoxyCodeLine{git checkout your-\/branch-\/name}
\DoxyCodeLine{\textcolor{preprocessor}{\#do stuff}}
\DoxyCodeLine{git commit -\/am \textcolor{stringliteral}{"{}I implemented this and that .."{}}}
\DoxyCodeLine{git push origin your-\/branch name}

\end{DoxyCode}


If you finished the development of this single feature and you tested it. You can think of making it to an accepted part of SOMA. This means we merge your branch to the master branch. Before we merge your branch, we check your code against our coding guidelines. (See section \mbox{\hyperlink{design_accept_code}{Guidelines for Coding}}.) For users only, do not use {\itshape any} branch for productive use. Use a tagged version of SOMA. For a list of all available tagged version type 
\begin{DoxyCode}{0}
\DoxyCodeLine{git tag}

\end{DoxyCode}
 and checkout the desired version\+: 
\begin{DoxyCode}{0}
\DoxyCodeLine{git checkout tag-\/specifier}

\end{DoxyCode}


This is the only way for you to get a stable version of SOMA. If you know what you do and you talked the developer of a specific branch, you are welcome to use this branch.

By the way we cannot guarantee any correctness of SOMA, but for the tagged versions, we do our best that the code is stable and does what you expect.\hypertarget{design_synchronous}{}\doxysection{Particle and Density Data}\label{design_synchronous}
There are two types of information if the model of SOMA. The particle data and the density data. And we have two times, two memory locations for the data, the host and the device. Per default the memory location is the device for performance reasons. If you want to the access the data on the host, you have to copy it from the device first. And if you modified something you have to upload the modifications afterwards. But be aware copying data back and forth can easily be a bottle neck. Consider, whether you can write a kernel for your access. All functions can assume that particle and density data are in agreement with each other. To ensure this a few notes are listed here.


\begin{DoxyItemize}
\item Each function that calculates something from a configuration should do this only once for a call of p-\/\texorpdfstring{$>$}{>}time. If the function is called more than once it should return fast in constant time.
\item Each function that needs precondition, that can be fulfilled by the call of a function should call this function at the beginning of the body.
\item Any function that modifies the bead positions or the density fields has to make sure, those characteristics are synchronous after the function call. E.\+g. call \mbox{\hyperlink{mesh_8c_a91f5d4bd90198f2aeb63f55c52964f49}{update\+\_\+density\+\_\+fields()}} before it returns.
\end{DoxyItemize}\hypertarget{design_analysis}{}\doxysection{Steps to be done if a new observable is implemented.}\label{design_analysis}
If you want to add a new analysis routine to SOMA you should do a few steps. As an example orient at the existing observable $ Rg $. Do the following steps\+:
\begin{DoxyItemize}
\item Edit the example analysis field in example/coord.\+xml and example/complex.\+xml
\item Edit the python script to generate a new ana.\+h5\+: \char`\"{}\+Conf\+Gen.\+py\char`\"{}
\begin{DoxyItemize}
\item Add your observable with default values to the default generation function of \char`\"{}\+Analysis\+File.\+\_\+init\+\_\+ana\+\_\+dict()\char`\"{}
\end{DoxyItemize}
\item Test your results by creating a new ana.\+h5 file.
\item Extend the \mbox{\hyperlink{structAna__Info}{Ana\+\_\+\+Info}} struct with your new Delta\+Mc. Delta\+Mc is the increment of your analysis,
\item Extend the init\+\_\+ana() with the read in of your new Delta\+Mc.
\begin{DoxyItemize}
\item Test your modifications.
\end{DoxyItemize}
\item Implement your analysis function in \mbox{\hyperlink{ana_8h}{ana.\+h}} and \mbox{\hyperlink{ana_8c}{ana.\+c}}. Do not forget the proper doc.
\begin{DoxyItemize}
\item Check compliance with the design rationale of calculators. (Lammps\+: Computes).
\item The default storage for updated data is on the GPU, so if you process data on the CPU dowload it first from the GPU. And if manipulate the data, upload the modifications afterwards.
\end{DoxyItemize}
\item Add to the \mbox{\hyperlink{ana_8c_a9ff69981d861d2cf3c6a5e1cc89e946c}{analytics()}} function a section for your new output. Try to reuse as much of the code as possible.
\item Check your results.
\item Add an entry of your observable to the feature list\+: \mbox{\hyperlink{features}{Features of SOMA}}
\item If your name is not already in the AUTHORS file, add it. In addition, add your name in the the license header of the files you modified.
\item Enjoy your success of adding a analysis routine to the program.
\end{DoxyItemize}\hypertarget{design_accept_code}{}\doxysection{Guidelines for Coding}\label{design_accept_code}
This section is intended to summarize mandatory aspects that the code of SOMA should feature at any point. If new functionalties or fixes are applied to SOMA, this new code fragments have to fulfill this criteria, otherwise the code will be rejected. So for coders this is a list of dos and donts and for reviewers this is a list to consider before new code is accepted. These guidelines are not designed to make your life harder, but to keep the life of everybody else as easy as possible.


\begin{DoxyItemize}
\item The list of importance is\+: 1) Performance 2) Readability 3) Design. ~\newline
 But non of this points is negligible.
\item The feature has to be physically correct. (In future version strict unit test are required.) Now simple test function are okay.
\item Test runs for every provided CMake configuration.
\item No warnings or errors of any compiler are tolerated.
\item \char`\"{}\+Quick and dirty\char`\"{} will never be accepted.
\item Every declaration in a header file has to be fully documented for doxygen. For declaration or implicit declaration in .c files a good reason to omit the documentation is needed and at least the declaration has to be declared as \textbackslash{}private. ~\newline
 The general \char`\"{}mainpage\char`\"{} documentation has to be up to date.
\item \char`\"{}\+Never Repeat Yourself\char`\"{} is strictly enforced.
\item Every functionality has to be as modular as possible.
\item Use runtime command line switches are welcome for new features.
\item Every new feature is not allowed to decrease the performance of the existing features.
\item GPU performance is weighted more important than CPU performance.
\item Any computationally demanding part has to be profiled. (The reviewer might ask for a profile.)
\item The code should have a decent format style. The format might be overwritten by an automatic indenting.
\item Defines to control the program execution are not permitted. In general defines are not to be used. If a constant is required, use a constant global variable (or local if possible). To this rule two exceptions can be granted. The first are inclusion guards for header files. Moreover, the inclusion guards are mandatory for every header file. The second exception are allowed if architecture depend parts of the code (like GPU oder Open\+MP) specific parts have to be capsuled.
\item Merge the newest master to your branch before you ask to merge your branch to master.
\item Core developers may be charged with cookies according to the cookie.\+list.
\item A reviewer might ask for further changes before merging, if a good reason is known.
\end{DoxyItemize}

If you disagree or you would like to propose a change of this list. Please talk to Ludwig. 