<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: Design Rationale</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="logo.png"/></td>
  <td id="projectalign">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div><div class="header">
  <div class="headertitle"><div class="title">Design Rationale </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h1><a class="anchor" id="Reviewing"></a>
a Branch</h1>
<p >This section helps to check certain points before a reviewer accepts a branch for SOMA.</p><ul>
<li>license acceptance from the authors of the branch</li>
<li>license header and output</li>
<li>"git diff" with master<ul>
<li>coding style: <a class="el" href="design.html#accept_code">Guidelines for Coding</a></li>
<li>flexibility</li>
<li>performance</li>
<li>never repeat yourself</li>
<li>part of the SOMA core or plugin</li>
</ul>
</li>
<li>compilation without warnings and errors for CPU and GPU builds. (gcc and pgcc)</li>
<li>all "old" tests pass without incident</li>
<li>ensure physically correct (integrated unit test)</li>
<li>coding correctness (integrated unit test + your own test)</li>
<li>ensure no performance degradation</li>
<li>optimized for GPUs and CPUs</li>
<li>profiling if necessary</li>
</ul>
<h1><a class="anchor" id="general"></a>
General Remarks</h1>
<p >We the development team of SOMA put in a lot of effort to get SOMA fast and flexible at the same time. This required a decent design. This sections compiles a few general remarks about this design. As well as a list of quality requirements for further extensions of SOMA. Please respect these guidelines, to keep SOMA flexible, fast and up-to-date. So before you start the development of anything, start by reading this page.</p>
<p >One important aspect for coordinated programming with more than one person is version control. For SOMA we agreed to use "git" for this purpose. The location of SOMA git server might change from time to time. Right now the location is the fusionforge sever of the TU-Dresden. You can find it <a href="https://fusionforge.zih.tu-dresden.de/scm/?group_id=1593">here </a>. For access it might be required to get an account on fusionforge and talk to Ludwig (ludwig.schneider (at) theorie.physik.uni-goettingen.de), he can grand access for you. To keep SOMA one consistent program please do all your development in the frame work of this git repository. But do your development <em>not</em> on the master branch. This branch is reserved for tested and accepted features of SOMA. Instead create your own branch and develop there. </p><div class="fragment"><div class="line">git branch your-branch-name</div>
<div class="line">git checkout your-branch-name</div>
<div class="line"><span class="preprocessor">#do stuff</span></div>
<div class="line">git commit -am <span class="stringliteral">&quot;I implemented this and that ..&quot;</span></div>
<div class="line">git push origin your-branch name</div>
</div><!-- fragment --><p >If you finished the development of this single feature and you tested it. You can think of making it to an accepted part of SOMA. This means we merge your branch to the master branch. Before we merge your branch, we check your code against our coding guidelines. (See section <a class="el" href="design.html#accept_code">Guidelines for Coding</a>.) For users only, do not use <em>any</em> branch for productive use. Use a tagged version of SOMA. For a list of all available tagged version type </p><div class="fragment"><div class="line">git tag</div>
</div><!-- fragment --><p> and checkout the desired version: </p><div class="fragment"><div class="line">git checkout tag-specifier</div>
</div><!-- fragment --><p >This is the only way for you to get a stable version of SOMA. If you know what you do and you talked the developer of a specific branch, you are welcome to use this branch.</p>
<p >By the way we cannot guarantee any correctness of SOMA, but for the tagged versions, we do our best that the code is stable and does what you expect.</p>
<h1><a class="anchor" id="synchronous"></a>
Particle and Density Data</h1>
<p >There are two types of information if the model of SOMA. The particle data and the density data. And we have two times, two memory locations for the data, the host and the device. Per default the memory location is the device for performance reasons. If you want to the access the data on the host, you have to copy it from the device first. And if you modified something you have to upload the modifications afterwards. But be aware copying data back and forth can easily be a bottle neck. Consider, whether you can write a kernel for your access. All functions can assume that particle and density data are in agreement with each other. To ensure this a few notes are listed here.</p>
<ul>
<li>Each function that calculates something from a configuration should do this only once for a call of p-&gt;time. If the function is called more than once it should return fast in constant time.</li>
<li>Each function that needs precondition, that can be fulfilled by the call of a function should call this function at the beginning of the body.</li>
<li>Any function that modifies the bead positions or the density fields has to make sure, those characteristics are synchronous after the function call. E.g. call <a class="el" href="mesh_8c.html#a91f5d4bd90198f2aeb63f55c52964f49">update_density_fields()</a> before it returns.</li>
</ul>
<h1><a class="anchor" id="analysis"></a>
Steps to be done if a new observable is implemented.</h1>
<p >If you want to add a new analysis routine to SOMA you should do a few steps. As an example orient at the existing observable <picture><source srcset="form_19_dark.png" media="(prefers-color-scheme: dark)"/><img class="formulaInl" alt="$ Rg $" src="form_19.png"/></picture>. Do the following steps:</p><ul>
<li>Edit the example analysis field in example/coord.xml and example/complex.xml</li>
<li>Edit the python script to generate a new ana.h5: "ConfGen.py"<ul>
<li>Add your observable with default values to the default generation function of "AnalysisFile._init_ana_dict()"</li>
</ul>
</li>
<li>Test your results by creating a new ana.h5 file.</li>
<li>Extend the <a class="el" href="structAna__Info.html" title="Basic information for analysis.">Ana_Info</a> struct with your new DeltaMc. DeltaMc is the increment of your analysis,</li>
<li>Extend the init_ana() with the read in of your new DeltaMc.<ul>
<li>Test your modifications.</li>
</ul>
</li>
<li>Implement your analysis function in <a class="el" href="ana_8h.html" title="Functions to calculate observables of the configurations.">ana.h</a> and <a class="el" href="ana_8c.html" title="Implementation of ana.h.">ana.c</a>. Do not forget the proper doc.<ul>
<li>Check compliance with the design rationale of calculators. (Lammps: Computes).</li>
<li>The default storage for updated data is on the GPU, so if you process data on the CPU dowload it first from the GPU. And if manipulate the data, upload the modifications afterwards.</li>
</ul>
</li>
<li>Add to the <a class="el" href="ana_8c.html#a9ff69981d861d2cf3c6a5e1cc89e946c" title="run the desired analytics">analytics()</a> function a section for your new output. Try to reuse as much of the code as possible.</li>
<li>Check your results.</li>
<li>Add an entry of your observable to the feature list: <a class="el" href="features.html">Features of SOMA</a></li>
<li>If your name is not already in the AUTHORS file, add it. In addition, add your name in the the license header of the files you modified.</li>
<li>Enjoy your success of adding a analysis routine to the program.</li>
</ul>
<h1><a class="anchor" id="accept_code"></a>
Guidelines for Coding</h1>
<p >This section is intended to summarize mandatory aspects that the code of SOMA should feature at any point. If new functionalties or fixes are applied to SOMA, this new code fragments have to fulfill this criteria, otherwise the code will be rejected. So for coders this is a list of dos and donts and for reviewers this is a list to consider before new code is accepted. These guidelines are not designed to make your life harder, but to keep the life of everybody else as easy as possible.</p>
<ul>
<li>The list of importance is: 1) Performance 2) Readability 3) Design. <br  />
 But non of this points is negligible.</li>
<li>The feature has to be physically correct. (In future version strict unit test are required.) Now simple test function are okay.</li>
<li>Test runs for every provided CMake configuration.</li>
<li>No warnings or errors of any compiler are tolerated.</li>
<li>"Quick and dirty" will never be accepted.</li>
<li>Every declaration in a header file has to be fully documented for doxygen. For declaration or implicit declaration in .c files a good reason to omit the documentation is needed and at least the declaration has to be declared as \private. <br  />
 The general "mainpage" documentation has to be up to date.</li>
<li>"Never Repeat Yourself" is strictly enforced.</li>
<li>Every functionality has to be as modular as possible.</li>
<li>Use runtime command line switches are welcome for new features.</li>
<li>Every new feature is not allowed to decrease the performance of the existing features.</li>
<li>GPU performance is weighted more important than CPU performance.</li>
<li>Any computationally demanding part has to be profiled. (The reviewer might ask for a profile.)</li>
<li>The code should have a decent format style. The format might be overwritten by an automatic indenting.</li>
<li>Defines to control the program execution are not permitted. In general defines are not to be used. If a constant is required, use a constant global variable (or local if possible). To this rule two exceptions can be granted. The first are inclusion guards for header files. Moreover, the inclusion guards are mandatory for every header file. The second exception are allowed if architecture depend parts of the code (like GPU oder OpenMP) specific parts have to be capsuled.</li>
<li>Merge the newest master to your branch before you ask to merge your branch to master.</li>
<li>Core developers may be charged with cookies according to the cookie.list.</li>
<li>A reviewer might ask for further changes before merging, if a good reason is known.</li>
</ul>
<p >If you disagree or you would like to propose a change of this list. Please talk to Ludwig. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Feb 7 2023 16:51:26 for My Project by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5
</small></address>
</body>
</html>
